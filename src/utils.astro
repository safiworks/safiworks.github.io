---
import { extraColor } from "./layouts/Layout.astro";
import type { MarkdownHeading } from "astro";

export type BlogPost = {
    uri: string;
    title: string;
    date: Date;
    description: string;
    project?: string;

    getHeadings: () => MarkdownHeading[];
    getContent: () => string;
};

export function getBlogPostUri(post: BlogPost): string {
    return `/blog/${post.uri}`;
}

export const blogPosts: BlogPost[] = Object.values(
    import.meta.glob("./blog/*.md", { eager: true }),
).map((val: any, _index, _arr) => {
    const front = val.frontmatter;

    return {
        uri: front.uri,
        title: front.title,
        date: new Date(front.date),
        description: front.description,
        project: front.project,
        getHeadings: val.getHeadings,
        getContent: val.compiledContent,
    };
});

export const blog_posts_map: Map<string, BlogPost> = new Map(
    blogPosts
        .sort((a, b) => b.date.getTime() - a.date.getTime())
        .map((post, _i, _a) => [post.uri, post]),
);

export type Badge = "stars" | "license" | "top_language";

export function badge(url: string, repo: string): string {
    const extraColorWithoutHas = extraColor.slice(1);
    return `${url}/${repo}?style=flat&color=${extraColorWithoutHas}`;
}

export function top_language_badge(repo: string): string {
    return badge("https://img.shields.io/github/languages/top", repo);
}

export function stars_badge(repo: string): string {
    return badge("https://img.shields.io/github/stars", repo);
}
export const license_badge = (repo: string) =>
    badge("https://img.shields.io/github/license", repo);
---
